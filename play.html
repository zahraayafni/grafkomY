<html>
	<head>
		<title>Play Beat.ly</title>
		<link href="https://fonts.googleapis.com/css?family=Cinzel" rel="stylesheet">
		<link href="https://fonts.googleapis.com/css?family=Fredoka+One" rel="stylesheet">
		<style>
			body { margin: 0; }
			canvas { width: 100%; height: 100% }
			@font-face
			{
				font-family: NeonLights;
				src: url('font/neon2.ttf'); 
			}
		</style>
	</head>
	<body>
	<script src="lib/build/three.js"></script>
	<script src="https://unpkg.com/three.texttexture@18.10.24"></script>
	<script src="lib/js/loaders/FBXLoader.js"></script>
	<script src="lib/js/libs/inflate.min.js"></script>
	<script src="lib/THREE.TextSprite.js"></script>
	<script src="https://threejs.org/examples/js/controls/OrbitControls.js"></script>
	<script>
		var camera;
		var scene;
		var colors;
		var renderer;
		var loader, loader2, loader3, loader4;
		var plate1, plate2, plate3, plate4;
		var plateArr = [];

		function init()
		{
			//Colors
			colors = ['#15959F', '#F1E4B3', '#F4A090', '#F26144'];

			//Scene
			scene = new THREE.Scene();

			//Camera
			camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 1, 1000);
			camera.position.set(0, 0, 50);
			camera.lookAt(scene.position);

			//Renderer
			renderer = new THREE.WebGLRenderer({antialias: true});

			renderer.setClearColor(0x000000);
			renderer.setSize( window.innerWidth, window.innerHeight );
			document.body.appendChild( renderer.domElement );

			//Grouping plate per lane
			var size = 0.5, posY = 120, posZ=-900;

			loader = new THREE.FBXLoader();
			loader.load('obj/bluePlate.fbx', function(obj) {
				plate1 = obj;
				plate1.scale.x = plate1.scale.y = plate1.scale.z = size;
				plate1.rotation.x = 0.15 * Math.PI;
				plate1.position.set(-200, posY, posZ);
			});

			loader2 = new THREE.FBXLoader();
			loader2.load('obj/redPlate.fbx', function(obj) {
				plate2 = obj;
				plate2.scale.x = plate2.scale.y = plate2.scale.z = size;
				plate2.rotation.x = 0.15 * Math.PI;
				plate2.position.set(-100, posY, posZ);
			});

			loader3 = new THREE.FBXLoader();
			loader3.load('obj/greenPlate.fbx', function(obj) {
				plate3 = obj;
				plate3.scale.x = plate3.scale.y = plate3.scale.z = size;
				plate3.rotation.x = 0.15 * Math.PI;
				plate3.position.set(0, posY, posZ);
			});

			loader4 = new THREE.FBXLoader();
			loader4.load('obj/yellowPlate.fbx', function(obj) {
				plate4 = obj;
				plate4.scale.x = plate4.scale.y = plate4.scale.z = size;
				plate4.rotation.x = 0.15 * Math.PI;
				plate4.position.set(100, posY, posZ);
			});

			//Susunan berdasarkan lagu "addPlate(detik keberapa, lane berapa)"
			addPlate(1, 1);
			addPlate(4, 2);
			addPlate(7,3);
			addPlate(9,4);
			
			//Title of the game
            var sprite = new THREE.TextSprite({
				textSize: 8,
				material: {
					color: 0x8cb8ff,
				},
				texture: {
					text: 'Beat.ly',
					fontFamily: 'NeonLights, Helvetica, sans-serif',
				},
			});
			sprite.position.set(-window.innerWidth/20, window.innerHeight/20, 0);
			scene.add(sprite);


			//GAME OVER pop-up
			var gameoverSprite = new THREE.TextSprite({
				textSize: 10,
				material: {
					color: 0xFF0000,
				},
				texture: {
					text: 'GAME OVER',
					fontFamily: 'Cinzel, serif',
					fontWeight: 'bold',
				},
			});
			gameoverSprite.position.set(-window.innerWidth/400, window.innerHeight/300, 0);
			//scene.add(gameoverSprite);

			//SCORE pop-up
			var scoreSprite = new THREE.TextSprite({
				textSize: 10,
				material: {
					color: 0x32a232,
				},
				texture: {
					text: 'SCORE',
					fontFamily: 'Fredoka One, cursive',
					fontWeight: 'bold',
				},
			});
			scoreSprite.position.set(-window.innerWidth/400, window.innerHeight/30, 0);
			//scene.add(scoreSprite);




			// Create a shape for background
			//var bgArr = [];
			var bg = new THREE.Group();
			var geometry = new THREE.DodecahedronBufferGeometry(1,0);
			var shapeCount = 500;
			
			for (var i = 0; i < shapeCount; i++) {
			  colorIndex = Math.round(Math.random() * colors.length - 1);
			  material = new THREE.MeshLambertMaterial({ color: colors[colorIndex] });
			  var shape = new THREE.Mesh(geometry, material);
			  var px = Math.random() * 100 - 50,
			      py = Math.random() * 100 - 50,
			      pz = Math.random() * 100 - 50;
			  var rx = Math.random() * Math.PI * 2,
			      ry = Math.random() * Math.PI * 2,
			      rz = Math.random() * Math.PI * 2;
			  var scale = Math.random() * .5;
			  shape.position.set(px,py,pz);
			  shape.rotation.set(rx,ry,rz);
			  shape.scale.set(scale,scale,scale);
			  
			  //bgArr.push(shape);
			  bg.add(shape);
			}
			scene.add(bg);

			//Add Controls
			var controls = new THREE.OrbitControls(camera, renderer.domElement);
			controls.minDistance = 50;
			controls.maxDistance = 200;
			controls.enableZoom = false;
			controls.enableRotate = false;

			//LIGHTING
			var ambientLight = new THREE.AmbientLight(0x111111);
        	scene.add(ambientLight);

        	// add pointLight for the shadows
        	var pointLight = new THREE.PointLight(0xffffff,1,0,0.55 * Math.PI);
        	pointLight.position.set(0, 15, 0);
        	pointLight.castShadow = true;

        	pointLight.shadow.mapSize.width = 1024 ;
        	pointLight.shadow.mapSize.height = 1024 ;

        	scene.add(pointLight);

			animate();

			var animSpeed = .001;
			var i = 0, distX=1, distY=3, distZ=3;

			function animate()
			{
				requestAnimationFrame( animate );

				bg.position.x = Math.sin(i/180)*10;
				bg.position.y = Math.sin(i/180)*5+5;
				i += 1;

				plateArr.forEach(function(el) {
					plateAnim(el);
				});
				renderer.render( scene, camera );
			}

			function plateAnim(plate)
			{
				plate.position.x += distX;
				plate.position.y -= distY;
				plate.position.z += distZ;

				if(plate.position.y < -window.innerHeight) {
					scene.remove(plate);
					plate = undefined;
				}
			}

			function addPlate(time, lane)
			{
				setTimeout(function(){
						switch(lane) {
							case 1:
								plateArr.push(plate1);
								scene.add(plate1);
								break;
							case 2:
								plateArr.push(plate2);
								scene.add(plate2);
								break;
							case 3:
								plateArr.push(plate3);
								scene.add(plate3);
								break;
							case 4:
								plateArr.push(plate4);
								scene.add(plate4);
								break;
						}
		          					
    			}, time*1000);
			}

		}

		function onResize() {
        	camera.aspect = window.innerWidth / window.innerHeight;
        	camera.updateProjectionMatrix();
        	renderer.setSize(window.innerWidth, window.innerHeight);
    	}

    	//Listen to keyboard event
    	window.onkeydown = function(event) {
    		var input = event.key;
    		var range = 10;
    		switch(input) {
        		case 'a': 
            		object.position.z += range;
            		break;
        		case 's':
            		object.position.z -= range;
            		break;
        		case 'k':
            		object.position.y += range;
            		break;
        		case 'l':
            		object.position.x += range;
            		break;
    		}
		}

    	window.onload = init;
    	// listen to the resize events
    	window.addEventListener('resize', onResize, false);
		
		</script>
	</body>
</html>